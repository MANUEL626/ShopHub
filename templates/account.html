{% extends 'partiels/page.html' %}

{% block content %}

{% include 'partiels/_alert_message.html' %}

<div class="user-info">
    <h5>{{ user.username }}</h5>
    <h5>{{ user.mail }}</h5>
</div>

<div class="tabs">
    <div class="tab" onclick="openTab(event, 'tab1')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="icon">
            <path fill-rule="evenodd" d="M6.32 2.577a49.255 49.255 0 0 1 11.36 0c1.497.174 2.57 1.46 2.57 2.93V21a.75.75 0 0 1-1.085.67L12 18.089l-7.165 3.583A.75.75 0 0 1 3.75 21V5.507c0-1.47 1.073-2.756 2.57-2.93Z" clip-rule="evenodd" />
        </svg>
    </div>
    <div class="tab" onclick="openTab(event, 'tab2')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="icon">
            <path fill-rule="evenodd" d="M12 3.75a6.715 6.715 0 0 0-3.722 1.118.75.75 0 1 1-.828-1.25 8.25 8.25 0 0 1 12.8 6.883c0 3.014-.574 5.897-1.62 8.543a.75.75 0 0 1-1.395-.551A21.69 21.69 0 0 0 18.75 10.5 6.75 6.75 0 0 0 12 3.75ZM6.157 5.739a.75.75 0 0 1 .21 1.04A6.715 6.715 0 0 0 5.25 10.5c0 1.613-.463 3.12-1.265 4.393a.75.75 0 0 1-1.27-.8A6.715 6.715 0 0 0 3.75 10.5c0-1.68.503-3.246 1.367-4.55a.75.75 0 0 1 1.04-.211ZM12 7.5a3 3 0 0 0-3 3c0 3.1-1.176 5.927-3.105 8.056a.75.75 0 1 1-1.112-1.008A10.459 10.459 0 0 0 7.5 10.5a4.5 4.5 0 1 1 9 0c0 .547-.022 1.09-.067 1.626a.75.75 0 0 1-1.495-.123c.041-.495.062-.996.062-1.503a3 3 0 0 0-3-3Zm0 2.25a.75.75 0 0 1 .75.75c0 3.908-1.424 7.485-3.781 10.238a.75.75 0 0 1-1.14-.975A14.19 14.19 0 0 0 11.25 10.5a.75.75 0 0 1 .75-.75Zm3.239 5.183a.75.75 0 0 1 .515.927 19.417 19.417 0 0 1-2.585 5.544.75.75 0 0 1-1.243-.84 17.915 17.915 0 0 0 2.386-5.116.75.75 0 0 1 .927-.515Z" clip-rule="evenodd" />
        </svg>
    </div>
    <div class="tab" onclick="openTab(event, 'tab3')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="icon">
            <path fill-rule="evenodd" d="M14.47 2.47a.75.75 0 0 1 1.06 0l6 6a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l4.72-4.72H9a5.25 5.25 0 1 0 0 10.5h3a.75.75 0 0 1 0 1.5H9a6.75 6.75 0 0 1 0-13.5h10.19l-4.72-4.72a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
        </svg>
    </div>
</div>
<br>
<hr>

<div id="tab1" class="tab-content">
    {% if user.favorite_items %}
             <div class="grid">
         {% for item in user.favorite_items %}
            <div class="grid-item">
                <div class="image-container">
                    <img class="item_img" src="{{ item.item.get_picture_url() }}" alt="{{ item.item.name }}">
                </div>
                <div class="info-container">
                    <div class="description-price">
                        <div class="description">{{ item.item.name }}</div>
                        <div class="price">{{ item.item.price }} XOF</div>
                    </div>
                    <a href="{{ url_for('remove_from_favorites', item_id=item.item.id) }}">
                        <svg class="button_icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="size-6">
                          <path d="M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM20.25 5.507v11.561L5.853 2.671c.15-.043.306-.075.467-.094a49.255 49.255 0 0 1 11.36 0c1.497.174 2.57 1.46 2.57 2.93ZM3.75 21V6.932l14.063 14.063L12 18.088l-7.165 3.583A.75.75 0 0 1 3.75 21Z" />
                        </svg>
                    </a>
                </div>
                <div class="button-container">
                    <button type="submit">Buy</button>
                </div>
            </div>
         {% endfor %}
    </div>
    {% endif %}
</div>

<div id="tab2" class="tab-content">
    <div class="connection">
        <div class="title">Update Username</div>
        <br>
        <form action="/account" method="post" class="account-form">
            <div class="input-group">
                <input type="text" name="username" id="username" pattern="^[^\s]+$" required>
                <label for="username">Username</label>
            </div>
            <input class="submit-btn" type="submit" value="Update">
        </form>
    </div>
    <br>
    <div class="connection">
        <div class="title">Update Email</div>
        <br>
        <form action="/account" method="post" class="account-form">
            <div class="input-group">
                <input type="email" name="mail" id="mail" pattern="^[^\s]+$" required>
                <label for="mail">Email</label>
            </div>
            <input class="submit-btn" type="submit" value="Update">
        </form>
    </div>
    <br>
    <div class="connection">
        <div class="title">Update Password</div>
        <br>
        <form action="/account" method="post" class="account-form">
            <div class="input-group">
                 <input type="password" name="password" id="password" pattern="^[^\s]+$" required>
                <label for="password">Password</label>
            </div>
            <div class="input-group">
                <input type="password" name="confirm_password" id="confirm_password" required>
                <label for="confirm_password">Confirm Password</label>
            </div>
            <input class="submit-btn" type="submit" value="Update">
        </form>
    </div>
    <br>
</div>

<div id="tab3" class="tab-content">
    <div class="log">
        {% if session.logged %}
            <button class="log_btn" type="button" onclick="openLogoutPopup()">Logout</button>
            <button class="log_btn" type="button" onclick="openDeletePopup()">Delete account</button>

            <div id="LogoutPopup" class="popup">
                <p>Logout?</p>
                <form action="{{ url_for('logout') }}" method="post" style="display:inline;">
                    <button class="log_btn" type="submit">Logout</button>
                    <button class="log_btn" type="button" onclick="closeLogoutPopup()">Cancel</button>
                </form>
            </div>
            <div id="DeletePopup" class="popup">
                <p>Delete account?</p>
                <form action="{{ url_for('user_delete') }}" method="post" style="display:inline;">
                    <button class="log_btn" type="submit">Delete account</button>
                    <button class="log_btn" type="button" onclick="closeDeletePopup()">Cancel</button>
                </form>
            </div>
        {% endif %}
    </div>
        <div id="popup-overlay" class="popup-overlay"></div>
        <script>
            function openLogoutPopup() {
                document.getElementById('LogoutPopup').classList.add('show');
                document.getElementById('popup-overlay').classList.add('show');
            }

            function closeLogoutPopup() {
                document.getElementById('LogoutPopup').classList.remove('show');
                document.getElementById('popup-overlay').classList.remove('show');
            }

            function openDeletePopup() {
                document.getElementById('DeletePopup').classList.add('show');
                document.getElementById('popup-overlay').classList.add('show');
            }

            function closeDeletePopup() {
                document.getElementById('DeletePopup').classList.remove('show');
                document.getElementById('popup-overlay').classList.remove('show');
            }
        </script>
</div>

<script>
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;

        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].classList.remove("active");
        }

        tablinks = document.getElementsByClassName("tab");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }

        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");

        // Save the active tab to localStorage
        localStorage.setItem('activeTab', tabName);
    }

    // Get the active tab from localStorage and activate it on page load
    document.addEventListener('DOMContentLoaded', (event) => {
        var activeTab = localStorage.getItem('activeTab');
        if (activeTab) {
            document.getElementById(activeTab).style.display = "block";
            document.getElementById(activeTab).classList.add("active");
            var activeTabButton = document.querySelector(`.tab[onclick="openTab(event, '${activeTab}')"]`);
            if (activeTabButton) {
                activeTabButton.classList.add("active");
            }
        } else {
            // Default to the first tab if no tab is active
            document.getElementsByClassName("tab-content")[0].style.display = "block";
            document.getElementsByClassName("tab-content")[0].classList.add("active");
            document.getElementsByClassName("tab")[0].classList.add("active");
        }
    });
</script>
{% endblock %}
